<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å†æ•°æ®è¿ç§»å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
        }
        .step {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .step h2 {
            margin-top: 0;
            color: #333;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            margin-right: 10px;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
            background: #f8f9fa;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“‹ ç®€å†æ•°æ®è¿ç§»å·¥å…·</h1>
    <p>å°†æ—§æ ¼å¼çš„ç®€å†æ•°æ®è¿ç§»åˆ°æ–°çš„ç»“æ„åŒ–æ ¼å¼</p>

    <!-- æ­¥éª¤ 1: æŸ¥çœ‹ç°æœ‰æ•°æ® -->
    <div class="step">
        <h2>æ­¥éª¤ 1: æŸ¥çœ‹ç°æœ‰æ•°æ®</h2>
        <button onclick="loadOldData()">åŠ è½½ç°æœ‰æ•°æ®</button>
        <div id="oldDataResult"></div>
    </div>

    <!-- æ­¥éª¤ 2: åˆ é™¤æ—§æ•°æ® -->
    <div class="step">
        <h2>æ­¥éª¤ 2: æ¸…ç†æ—§æ•°æ®ï¼ˆå¯é€‰ï¼‰</h2>
        <p class="warning">âš ï¸ è¿™å°†åˆ é™¤æ‰€æœ‰æ—§æ ¼å¼çš„æ•°æ®ï¼Œè¯·ç¡®è®¤åå†æ“ä½œ</p>
        <button class="danger" onclick="deleteOldData()">åˆ é™¤æ—§æ•°æ®</button>
        <div id="deleteResult"></div>
    </div>

    <!-- æ­¥éª¤ 3: åˆ›å»ºæ–°æ•°æ® -->
    <div class="step">
        <h2>æ­¥éª¤ 3: åˆ›å»ºæ–°æ ¼å¼çš„ç®€å†æ•°æ®</h2>
        <button class="success" onclick="createNewData()">åˆ›å»ºå®Œæ•´ç®€å†</button>
        <div id="createResult"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = "https://jcxlgmmudtbizyinqyrq.supabase.co"
        const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjeGxnbW11ZHRiaXp5aW5xeXJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2MTc3MzksImV4cCI6MjA3NzE5MzczOX0.SYmaIOEVhS5P-wJmlUoP_mhOlrhVQo7OaEZYbDGKuVg"
        
        const { createClient } = supabase
        const client = createClient(supabaseUrl, supabaseAnonKey)

        let oldData = []

        function showResult(elementId, message, type = 'success') {
            const el = document.getElementById(elementId)
            el.className = 'result ' + type
            el.innerHTML = message
        }

        async function loadOldData() {
            try {
                showResult('oldDataResult', 'æ­£åœ¨åŠ è½½...', 'warning')
                
                const { data, error } = await client
                    .from('resume_sections')
                    .select('*')
                    .order('created_at', { ascending: true })
                
                if (error) throw error
                
                oldData = data || []
                
                showResult('oldDataResult', `
                    <strong>æ‰¾åˆ° ${oldData.length} æ¡æ•°æ®ï¼š</strong>
                    <pre>${JSON.stringify(oldData, null, 2)}</pre>
                `, 'success')
            } catch (err) {
                showResult('oldDataResult', `åŠ è½½å¤±è´¥: ${err.message}`, 'error')
            }
        }

        async function deleteOldData() {
            if (!confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰æ—§æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return
            
            try {
                showResult('deleteResult', 'æ­£åœ¨åˆ é™¤...', 'warning')
                
                const { error } = await client
                    .from('resume_sections')
                    .delete()
                    .neq('id', '00000000-0000-0000-0000-000000000000') // åˆ é™¤æ‰€æœ‰
                
                if (error) throw error
                
                showResult('deleteResult', 'âœ… æ—§æ•°æ®å·²åˆ é™¤', 'success')
            } catch (err) {
                showResult('deleteResult', `åˆ é™¤å¤±è´¥: ${err.message}`, 'error')
            }
        }

        async function createNewData() {
            try {
                showResult('createResult', 'æ­£åœ¨åˆ›å»ºæ–°æ•°æ®...', 'warning')
                
                // 1. ä¸ªäººä¿¡æ¯
                const profileData = {
                    section_type: 'profile',
                    title: 'ä¸ªäººä¿¡æ¯',
                    content: JSON.stringify({
                        name: 'è´è´',
                        title: 'ç”µå•†è®¾è®¡å¸ˆ',
                        bio: 'ä»ä¼ ç»Ÿå®¶çººè¡Œä¸šèµ·æ­¥ï¼Œæ·±åº¦å‚ä¸ç”µå•†æ•°å­—åŒ–è½¬å‹æµªæ½®ã€‚å¤šå¹´å®æˆ˜ç»éªŒæ¶µç›–å“ç‰Œè§†è§‰æ„å»ºã€äº§å“åŒ…è£…è®¾è®¡ã€ç”µå•†å…¨é“¾è·¯è§†è§‰è¥é”€ï¼Œæ“…é•¿å°†äº§å“ç‰¹æ€§è½¬åŒ–ä¸ºæ‰“åŠ¨æ¶ˆè´¹è€…çš„è§†è§‰è¯­è¨€ã€‚'
                    }),
                    metadata: {
                        name: 'è´è´',
                        title: 'ç”µå•†è®¾è®¡å¸ˆ',
                        avatar_url: '',
                        bio: 'ä»ä¼ ç»Ÿå®¶çººè¡Œä¸šèµ·æ­¥ï¼Œæ·±åº¦å‚ä¸ç”µå•†æ•°å­—åŒ–è½¬å‹æµªæ½®ã€‚å¤šå¹´å®æˆ˜ç»éªŒæ¶µç›–å“ç‰Œè§†è§‰æ„å»ºã€äº§å“åŒ…è£…è®¾è®¡ã€ç”µå•†å…¨é“¾è·¯è§†è§‰è¥é”€ï¼Œæ“…é•¿å°†äº§å“ç‰¹æ€§è½¬åŒ–ä¸ºæ‰“åŠ¨æ¶ˆè´¹è€…çš„è§†è§‰è¯­è¨€ã€‚',
                        location: 'æ­å·',
                        email: 'boyj31639@gmail.com',
                        phone: '+86 138 0000 0000',
                        website: 'https://yourwebsite.com'
                    },
                    display_order: 1
                }

                // 2. å·¥ä½œç»å†
                const workData = {
                    section_type: 'work_experience',
                    title: 'å·¥ä½œç»å†',
                    content: JSON.stringify({
                        experiences: [
                            {
                                company: 'ABCç”µå•†å…¬å¸',
                                position: 'é«˜çº§ç”µå•†è®¾è®¡å¸ˆ',
                                start_date: '2020-01',
                                end_date: '',
                                current: true,
                                description: 'è´Ÿè´£ç”µå•†å¹³å°è§†è§‰è®¾è®¡ï¼ŒåŒ…æ‹¬äº§å“è¯¦æƒ…é¡µã€æ´»åŠ¨é¡µé¢ã€å“ç‰Œè§†è§‰ç­‰ã€‚'
                            }
                        ]
                    }),
                    metadata: {
                        experiences: [
                            {
                                company: 'ABCç”µå•†å…¬å¸',
                                position: 'é«˜çº§ç”µå•†è®¾è®¡å¸ˆ',
                                start_date: '2020-01',
                                end_date: '',
                                current: true,
                                description: 'è´Ÿè´£ç”µå•†å¹³å°è§†è§‰è®¾è®¡ï¼ŒåŒ…æ‹¬äº§å“è¯¦æƒ…é¡µã€æ´»åŠ¨é¡µé¢ã€å“ç‰Œè§†è§‰ç­‰ã€‚æå‡è½¬åŒ–ç‡20%ï¼Œå®Œæˆå¤šä¸ªçˆ†æ¬¾äº§å“çš„è§†è§‰è®¾è®¡ã€‚'
                            }
                        ]
                    },
                    display_order: 2
                }

                // 3. æ•™è‚²èƒŒæ™¯
                const educationData = {
                    section_type: 'education',
                    title: 'æ•™è‚²èƒŒæ™¯',
                    content: JSON.stringify({
                        education: [
                            {
                                school: 'æŸæŸå¤§å­¦',
                                degree: 'æœ¬ç§‘',
                                major: 'è§†è§‰ä¼ è¾¾è®¾è®¡',
                                start_date: '2015-09',
                                end_date: '2019-06',
                                current: false,
                                gpa: '',
                                description: ''
                            }
                        ]
                    }),
                    metadata: {
                        education: [
                            {
                                school: 'æŸæŸå¤§å­¦',
                                degree: 'æœ¬ç§‘',
                                major: 'è§†è§‰ä¼ è¾¾è®¾è®¡',
                                start_date: '2015-09',
                                end_date: '2019-06',
                                current: false,
                                gpa: '3.8/4.0',
                                description: 'ä¸»ä¿®å¹³é¢è®¾è®¡ã€å“ç‰Œè®¾è®¡ã€æ•°å­—åª’ä½“è®¾è®¡ç­‰è¯¾ç¨‹'
                            }
                        ]
                    },
                    display_order: 3
                }

                // 4. æŠ€æœ¯æ ˆ
                const techStackData = {
                    section_type: 'tech_stack',
                    title: 'æŠ€æœ¯æ ˆ',
                    content: JSON.stringify({
                        stacks: [
                            {
                                category: 'è®¾è®¡å·¥å…·',
                                technologies: [
                                    { name: 'Figma', level: 'expert' },
                                    { name: 'Sketch', level: 'advanced' },
                                    { name: 'Adobe Creative Suite', level: 'expert' }
                                ]
                            },
                            {
                                category: 'åŸå‹å·¥å…·',
                                technologies: [
                                    { name: 'å¢¨åˆ€', level: 'advanced' },
                                    { name: 'Axure', level: 'intermediate' }
                                ]
                            }
                        ]
                    }),
                    metadata: {
                        stacks: [
                            {
                                category: 'è®¾è®¡å·¥å…·',
                                technologies: [
                                    { name: 'Figma', level: 'expert' },
                                    { name: 'Sketch', level: 'advanced' },
                                    { name: 'Adobe Creative Suite', level: 'expert' }
                                ]
                            },
                            {
                                category: 'åŸå‹å·¥å…·',
                                technologies: [
                                    { name: 'å¢¨åˆ€', level: 'advanced' },
                                    { name: 'Axure', level: 'intermediate' }
                                ]
                            }
                        ]
                    },
                    display_order: 4
                }

                // 5. ä¸“ä¸šæŠ€èƒ½
                const skillsData = {
                    section_type: 'skills',
                    title: 'ä¸“ä¸šæŠ€èƒ½',
                    content: JSON.stringify({
                        skills: [
                            { name: 'ç”¨æˆ·ç•Œé¢è®¾è®¡', description: 'ç²¾é€šç”µå•†UIè®¾è®¡ï¼Œæ“…é•¿æå‡ç”¨æˆ·ä½“éªŒå’Œè½¬åŒ–ç‡' },
                            { name: 'ç”¨æˆ·ä½“éªŒè®¾è®¡', description: 'æ·±å…¥ç†è§£ç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–è´­ç‰©æµç¨‹' },
                            { name: 'ç”µå•†è®¾è®¡', description: 'ç†Ÿæ‚‰ç”µå•†å…¨é“¾è·¯è®¾è®¡ï¼ŒåŒ…æ‹¬è¯¦æƒ…é¡µã€æ´»åŠ¨é¡µç­‰' },
                            { name: 'è®¾è®¡ç³»ç»Ÿ', description: 'å»ºç«‹å’Œç»´æŠ¤è®¾è®¡è§„èŒƒï¼Œæå‡å›¢é˜Ÿæ•ˆç‡' },
                            { name: 'å“ç‰Œè®¾è®¡', description: 'å“ç‰Œè§†è§‰è¯†åˆ«ç³»ç»Ÿè®¾è®¡ä¸åº”ç”¨' }
                        ]
                    }),
                    metadata: {
                        skills: [
                            { name: 'ç”¨æˆ·ç•Œé¢è®¾è®¡', description: 'ç²¾é€šç”µå•†UIè®¾è®¡ï¼Œæ“…é•¿æå‡ç”¨æˆ·ä½“éªŒå’Œè½¬åŒ–ç‡' },
                            { name: 'ç”¨æˆ·ä½“éªŒè®¾è®¡', description: 'æ·±å…¥ç†è§£ç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–è´­ç‰©æµç¨‹' },
                            { name: 'ç”µå•†è®¾è®¡', description: 'ç†Ÿæ‚‰ç”µå•†å…¨é“¾è·¯è®¾è®¡ï¼ŒåŒ…æ‹¬è¯¦æƒ…é¡µã€æ´»åŠ¨é¡µç­‰' },
                            { name: 'è®¾è®¡ç³»ç»Ÿ', description: 'å»ºç«‹å’Œç»´æŠ¤è®¾è®¡è§„èŒƒï¼Œæå‡å›¢é˜Ÿæ•ˆç‡' },
                            { name: 'å“ç‰Œè®¾è®¡', description: 'å“ç‰Œè§†è§‰è¯†åˆ«ç³»ç»Ÿè®¾è®¡ä¸åº”ç”¨' }
                        ]
                    },
                    display_order: 5
                }

                // æ‰¹é‡æ’å…¥
                const allData = [profileData, workData, educationData, techStackData, skillsData]
                
                const { data, error } = await client
                    .from('resume_sections')
                    .insert(allData)
                    .select()
                
                if (error) throw error
                
                showResult('createResult', `
                    <strong>âœ… æˆåŠŸåˆ›å»º ${data.length} ä¸ªç®€å†æ¿å—ï¼š</strong>
                    <ul>
                        <li>âœ“ ä¸ªäººä¿¡æ¯</li>
                        <li>âœ“ å·¥ä½œç»å†</li>
                        <li>âœ“ æ•™è‚²èƒŒæ™¯</li>
                        <li>âœ“ æŠ€æœ¯æ ˆ</li>
                        <li>âœ“ ä¸“ä¸šæŠ€èƒ½</li>
                    </ul>
                    <p>ç°åœ¨å¯ä»¥å›åˆ°ç®¡ç†åå°æŸ¥çœ‹å’Œç¼–è¾‘äº†ï¼</p>
                `, 'success')
            } catch (err) {
                showResult('createResult', `åˆ›å»ºå¤±è´¥: ${err.message}`, 'error')
            }
        }
    </script>
</body>
</html>
