<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase 连接测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background: #f5f5f5;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Supabase 数据库连接测试</h1>
    
    <button onclick="testConnection()">测试连接</button>
    <button onclick="checkTable()">检查表结构</button>
    <button onclick="testInsert()">测试插入数据</button>
    
    <div id="result"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = "https://jcxlgmmudtbizyinqyrq.supabase.co"
        const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjeGxnbW11ZHRiaXp5aW5xeXJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2MTc3MzksImV4cCI6MjA3NzE5MzczOX0.SYmaIOEVhS5P-wJmlUoP_mhOlrhVQo7OaEZYbDGKuVg"
        
        const { createClient } = supabase
        const client = createClient(supabaseUrl, supabaseAnonKey)

        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result')
            resultDiv.className = 'result ' + (isError ? 'error' : 'success')
            resultDiv.innerHTML = message
        }

        async function testConnection() {
            try {
                showResult('正在测试连接...')
                
                const { data, error } = await client
                    .from('resume_sections')
                    .select('count')
                    .limit(1)
                
                if (error) {
                    showResult(`连接失败: ${error.message}<br><pre>${JSON.stringify(error, null, 2)}</pre>`, true)
                } else {
                    showResult('✅ 连接成功！可以访问 resume_sections 表')
                }
            } catch (err) {
                showResult(`错误: ${err.message}`, true)
            }
        }

        async function checkTable() {
            try {
                showResult('正在检查表结构...')
                
                const { data, error } = await client
                    .from('resume_sections')
                    .select('*')
                    .limit(1)
                
                if (error) {
                    if (error.code === '42P01') {
                        showResult(`❌ 表不存在！需要创建 resume_sections 表。<br><br>请在 Supabase Dashboard 的 SQL Editor 中执行：<br><pre>CREATE TABLE resume_sections (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    section_type VARCHAR(50) NOT NULL,
    title VARCHAR(255),
    content TEXT,
    metadata JSONB,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);</pre>`, true)
                    } else {
                        showResult(`检查失败: ${error.message}<br><pre>${JSON.stringify(error, null, 2)}</pre>`, true)
                    }
                } else {
                    showResult(`✅ 表存在！<br>当前记录数: ${data.length}<br><pre>${JSON.stringify(data, null, 2)}</pre>`)
                }
            } catch (err) {
                showResult(`错误: ${err.message}`, true)
            }
        }

        async function testInsert() {
            try {
                showResult('正在测试插入数据...')
                
                const testData = {
                    section_type: 'test',
                    title: '测试数据',
                    content: '这是一条测试数据',
                    metadata: { test: true },
                    display_order: 0
                }
                
                const { data, error } = await client
                    .from('resume_sections')
                    .insert([testData])
                    .select()
                
                if (error) {
                    showResult(`插入失败: ${error.message}<br><pre>${JSON.stringify(error, null, 2)}</pre>`, true)
                } else {
                    showResult(`✅ 插入成功！<br><pre>${JSON.stringify(data, null, 2)}</pre>`)
                }
            } catch (err) {
                showResult(`错误: ${err.message}`, true)
            }
        }
    </script>
</body>
</html>
